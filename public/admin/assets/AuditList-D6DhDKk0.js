import{n as c}from"./index-BCOtO_Mw.js";import{r as m,s as y,c as E,o as _,b as x,A as B,x as C,n as D,w as l,e as i,E as o,d as s,j as v,q as f}from"./index-CYHA9V5Y.js";const N={class:"audit-list"},M={__name:"AuditList",setup(A){const n=m(!1),d=m([]),r=async()=>{n.value=!0;try{const t=await c.getList({pageNum:1,pageSize:100,status:"PENDING"});d.value=t.data.records}catch(t){o.error(t.message||"加载失败")}finally{n.value=!1}},g=async t=>{await f.confirm("确定要通过审核吗？","提示",{type:"warning"});try{await c.audit(t.id,{status:"APPROVED",remark:""}),o.success("审核通过"),r()}catch(e){o.error(e.message||"操作失败")}},b=async t=>{await f.prompt("请输入拒绝原因","拒绝审核",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:e})=>{c.audit(t.id,{status:"REJECTED",remark:e}).then(()=>{o.success("已拒绝"),r()}).catch(a=>{o.error(a.message||"操作失败")})}).catch(()=>{})};return y(()=>{r()}),(t,e)=>{const a=i("el-table-column"),u=i("el-button"),h=i("el-table"),k=C("loading");return _(),E("div",N,[e[2]||(e[2]=x("h2",null,"审核管理",-1)),B((_(),D(h,{data:d.value,style:{width:"100%"}},{default:l(()=>[s(a,{prop:"title",label:"标题"}),s(a,{prop:"authorName",label:"作者",width:"120"}),s(a,{prop:"createTime",label:"提交时间",width:"180"}),s(a,{label:"操作",width:"200"},{default:l(({row:p})=>[s(u,{link:"",type:"success",onClick:w=>g(p)},{default:l(()=>[...e[0]||(e[0]=[v("通过",-1)])]),_:1},8,["onClick"]),s(u,{link:"",type:"danger",onClick:w=>b(p)},{default:l(()=>[...e[1]||(e[1]=[v("拒绝",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[k,n.value]])])}}};export{M as default};
