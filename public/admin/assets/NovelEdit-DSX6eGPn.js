import{_ as B,r as f,a as D,s as j,m as I,E as n,c as x,o as y,b as p,d as l,t as _,w as o,e as i,f as L,g as V,C as M,p as S,G as q,j as b}from"./index-CYHA9V5Y.js";import{n as v}from"./index-BCOtO_Mw.js";const A={class:"novel-edit"},G={class:"edit-header"},O={class:"subtitle"},T={key:0,class:"cover-preview"},F=["src"],H={__name:"NovelEdit",setup(J){const m=I(),g=L(),h=f(null),d=f(!1),c=f(!1),e=D({title:"",category:"",cover:"",description:""}),E={title:[{required:!0,message:"请输入标题",trigger:"blur"}]},k=async()=>{await h.value.validate(),d.value=!0;try{c.value?(await v.update(m.params.id,e),n.success("更新成功")):(await v.create(e),n.success("创建成功")),g.push("/novel")}catch(r){n.error(r.message||"操作失败")}finally{d.value=!1}},C=()=>{g.back()},N=()=>{n.warning("封面图片加载失败，请检查URL是否正确")};j(()=>{m.params.id&&(c.value=!0,R())});const R=async()=>{try{const r=await v.getDetail(m.params.id);Object.assign(e,r.data)}catch{n.error("加载小说详情失败")}};return(r,t)=>{const u=i("el-input"),s=i("el-form-item"),w=i("el-button"),U=i("el-form"),z=i("el-card");return y(),x("div",A,[p("div",G,[p("h2",null,_(c.value?"编辑小说":"新增小说"),1),p("p",O,_(c.value?"修改小说信息":"创建新的小说"),1)]),l(z,null,{default:o(()=>[l(U,{model:e,rules:E,ref_key:"formRef",ref:h,"label-width":"100px",style:{"max-width":"800px"}},{default:o(()=>[l(s,{label:"标题",prop:"title"},{default:o(()=>[l(u,{modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=a=>e.title=a),placeholder:"请输入小说标题",size:"large","prefix-icon":V(M),maxlength:"100","show-word-limit":""},null,8,["modelValue","prefix-icon"])]),_:1}),l(s,{label:"分类",prop:"category"},{default:o(()=>[l(u,{modelValue:e.category,"onUpdate:modelValue":t[1]||(t[1]=a=>e.category=a),placeholder:"请输入分类，如：玄幻、都市、言情等",size:"large",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,{label:"封面",prop:"cover"},{default:o(()=>[l(u,{modelValue:e.cover,"onUpdate:modelValue":t[2]||(t[2]=a=>e.cover=a),placeholder:"请输入封面图片URL",size:"large","prefix-icon":V(q)},null,8,["modelValue","prefix-icon"]),e.cover?(y(),x("div",T,[p("img",{src:e.cover,alt:"封面预览",onError:N},null,40,F)])):S("",!0)]),_:1}),l(s,{label:"简介",prop:"description"},{default:o(()=>[l(u,{modelValue:e.description,"onUpdate:modelValue":t[3]||(t[3]=a=>e.description=a),type:"textarea",rows:6,placeholder:"请输入小说简介，建议200字以内",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,null,{default:o(()=>[l(w,{type:"primary",onClick:k,loading:d.value,size:"large"},{default:o(()=>[b(_(d.value?"保存中...":"保存"),1)]),_:1},8,["loading"]),l(w,{onClick:C,size:"large"},{default:o(()=>[...t[4]||(t[4]=[b("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},Q=B(H,[["__scopeId","data-v-3f14cd90"]]);export{Q as default};
