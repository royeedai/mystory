# 功能说明

本文档详细说明小说阅读平台的各项功能特性。

## 已完成功能 ✅

### 1. 认证系统

#### 后台登录
- JWT Token认证
- 密码BCrypt加密存储
- 支持管理员和作者两种角色
- 登录状态持久化

#### 微信小程序登录
- 完整的微信登录流程
- 自动调用微信API获取openid
- 新用户自动注册
- 老用户自动登录
- 生成JWT token用于后续请求认证

**配置要求**：
- 需要配置微信小程序AppID和Secret
- 通过环境变量 `WX_APPID` 和 `WX_SECRET` 配置

### 2. 小说管理

#### 后端功能
- ✅ 小说CRUD操作（创建、读取、更新、删除）
- ✅ 小说审核流程（草稿、待审核、已审核、已拒绝）
- ✅ 小说状态管理
- ✅ 阅读量统计
- ✅ 分类管理
- ✅ 排序功能

#### 管理后台功能
- ✅ 小说列表展示（分页、搜索、筛选）
- ✅ 小说编辑（标题、封面、简介、分类）
- ✅ 小说删除
- ✅ 提交审核
- ✅ 状态管理
- ✅ 权限控制（作者只能管理自己的小说，管理员可以管理所有小说）

### 3. 章节管理

#### 后端功能
- ✅ 章节CRUD操作
- ✅ 章节序号管理
- ✅ 字数统计（自动去除HTML标签）
- ✅ 章节内容分页
- ✅ 章节列表查询

#### 管理后台功能
- ✅ 章节列表展示（按序号排序）
- ✅ 富文本编辑器（Quill编辑器）
  - 支持格式化（加粗、斜体、下划线等）
  - 支持标题、列表
  - 支持图片、链接
  - 实时字数统计
- ✅ 章节编辑和删除
- ✅ 权限控制（作者只能编辑自己的章节，管理员可以编辑所有章节）

### 4. 阅读功能

#### 阅读记录
- ✅ 自动保存阅读进度（章节ID、页码）
- ✅ 阅读记录查询
- ✅ 多端阅读进度同步

#### 试看控制
- ✅ 试看时间限制（秒为单位）
- ✅ 试看权限检查
- ✅ 试看时间显示
- ✅ 试看时间到期提示

#### 阅读页面功能
- ✅ **翻页功能**：上一页/下一页按钮
- ✅ **字体大小调整**：支持24-48rpx范围调整
- ✅ **行间距调整**：支持1.2-2.5倍行间距
- ✅ **夜间模式**：支持深色背景阅读
- ✅ **背景色选择**：4种背景色可选
  - 米色（默认）
  - 绿色护眼
  - 灰色
  - 黑色（夜间模式）
- ✅ **阅读进度保存**：自动保存阅读进度
- ✅ **设置持久化**：阅读设置本地保存
- ✅ **章节内容分页**：长章节自动分页
- ✅ **页码显示**：当前页/总页数

### 5. 广告激励系统

#### 功能说明
- ✅ 观看激励广告增加试看时间
- ✅ 广告观看记录
- ✅ 奖励时间累计
- ✅ 试看时间实时更新

#### 实现细节
- 后端提供广告奖励接口
- 小程序端集成微信激励广告
- 观看广告后调用后端接口增加试看时间
- 记录广告观看历史

**配置要求**：
- 需要在 `novel-app/pages/reader/reader.vue` 中配置广告位ID

### 6. 用户管理

#### 小程序用户管理
- ✅ 用户信息查询
- ✅ 用户状态管理
- ✅ 试看时间管理
- ✅ 用户列表（管理员）

#### 系统用户管理
- ✅ 用户列表（管理员）
- ✅ 用户状态管理（启用/禁用）
- ✅ 角色管理（作者/管理员）
- ✅ 用户信息编辑

### 7. 审核管理

#### 功能说明
- ✅ 审核列表展示（待审核、已审核、已拒绝）
- ✅ 审核操作（通过/拒绝）
- ✅ 审核备注（管理员可以添加审核意见）
- ✅ 审核历史记录
- ✅ 审核时间记录

#### 权限控制
- 只有管理员可以审核小说
- 作者可以查看自己小说的审核状态
- 审核操作会记录审核人和审核时间

### 8. 权限控制系统

#### 角色定义
- **ADMIN（管理员）**：拥有所有权限
  - 可以管理所有小说和章节
  - 可以审核小说
  - 可以管理用户
- **AUTHOR（作者）**：拥有部分权限
  - 只能管理自己的小说和章节
  - 可以提交审核
  - 不能审核小说

#### 权限实现
- 后端使用Spring Security进行权限控制
- JWT Token中包含用户角色信息
- 接口级别权限验证
- 数据级别权限过滤

## 功能特性详解

### 富文本编辑器

使用Quill编辑器实现章节内容编辑：

**支持的格式**：
- 文本格式：加粗、斜体、下划线、删除线
- 标题：H1-H6
- 列表：有序列表、无序列表
- 链接和图片
- 代码块

**字数统计**：
- 实时统计章节字数
- 自动去除HTML标签
- 只统计纯文本内容

### 阅读体验优化

#### 字体和排版
- 字体大小：24-48rpx，可自由调整
- 行间距：1.2-2.5倍，可自由调整
- 段落间距：自动优化

#### 背景和主题
- 4种背景色可选
- 夜间模式（深色背景）
- 设置持久化（下次打开自动应用）

#### 阅读进度
- 自动保存阅读进度
- 支持多端同步
- 章节列表显示阅读进度标识

### 微信登录流程

1. 小程序端调用 `wx.login()` 获取code
2. 将code发送到后端 `/api/auth/wx-login`
3. 后端调用微信API `https://api.weixin.qq.com/sns/jscode2session` 获取openid
4. 根据openid查询用户，不存在则自动注册
5. 生成JWT token返回给小程序
6. 小程序保存token，后续请求携带token

## 使用说明

### 管理后台使用

#### 登录
1. 访问管理后台：`http://localhost:3000`
2. 使用管理员或作者账号登录
3. 登录成功后跳转到仪表盘

#### 小说管理
1. 点击"小说管理"菜单
2. 可以查看小说列表、新增小说、编辑小说
3. 作者只能看到自己的小说，管理员可以看到所有小说
4. 点击"提交审核"将小说状态改为待审核

#### 章节管理
1. 在小说列表中点击"章节管理"
2. 可以查看章节列表、新增章节、编辑章节
3. 使用富文本编辑器编辑章节内容
4. 保存后自动计算字数

#### 审核管理
1. 管理员可以访问"审核管理"菜单
2. 查看待审核的小说列表
3. 点击"审核"按钮进行审核操作
4. 可以添加审核备注

### 小程序使用

#### 登录
1. 打开小程序，自动调用微信登录
2. 首次使用会自动注册账号
3. 登录成功后显示用户信息

#### 浏览小说
1. 首页显示小说列表
2. 可以搜索、筛选小说
3. 点击小说进入详情页

#### 阅读小说
1. 在小说详情页点击"开始阅读"
2. 选择章节开始阅读
3. 点击页面显示/隐藏工具栏
4. 点击设置按钮调整阅读设置
5. 阅读进度自动保存

#### 观看广告
1. 试看时间不足时，可以观看广告增加试看时间
2. 点击"观看广告"按钮
3. 观看完成后自动增加试看时间

## 注意事项

### 微信登录
- 需要配置正确的AppID和Secret
- 小程序AppID必须与后端配置一致
- 需要在小程序后台配置服务器域名

### 广告功能
- 需要在小程序中配置实际的广告位ID
- 广告位ID在 `novel-app/pages/reader/reader.vue` 中配置
- 需要在小程序后台开通激励广告功能

### 富文本内容
- 章节内容以HTML格式存储
- 阅读时会自动渲染HTML内容
- 字数统计会自动去除HTML标签

### 权限控制
- 管理员可以编辑所有章节
- 作者只能编辑自己的章节
- 审核权限只有管理员拥有

### 阅读设置
- 阅读设置会保存在本地存储中
- 阅读进度会自动同步到服务器
- 多端登录时阅读进度会同步

## 开发规划 🚀

### 高优先级功能

#### 1. 搜索功能优化
- [ ] 全文搜索功能（Elasticsearch集成）
- [ ] 热门搜索词统计
- [ ] 搜索历史记录
- [ ] 搜索建议和自动补全
- [ ] 搜索结果排序优化

#### 2. 评论系统
- [ ] 章节评论功能
- [ ] 评论回复功能
- [ ] 评论点赞/点踩
- [ ] 评论审核机制
- [ ] 评论通知功能

#### 3. 收藏和书架功能
- [ ] 小说收藏功能
- [ ] 个人书架管理
- [ ] 书架分类（在读、已读、想读）
- [ ] 收藏列表展示
- [ ] 书架同步功能

### 中优先级功能

#### 4. 推荐系统
- [ ] 热门推荐算法
- [ ] 个性化推荐（基于阅读历史）
- [ ] 相似小说推荐
- [ ] 分类推荐
- [ ] 推荐位管理

#### 5. 数据统计和分析
- [ ] 阅读数据统计（阅读量、阅读时长）
- [ ] 用户行为分析
- [ ] 小说热度排行
- [ ] 作者数据统计
- [ ] 管理后台数据看板

#### 6. 支付和会员系统
- [ ] VIP会员体系
- [ ] 付费章节功能
- [ ] 支付集成（微信支付）
- [ ] 会员权益管理
- [ ] 订单管理

#### 7. 消息通知系统
- [ ] 系统消息推送
- [ ] 评论回复通知
- [ ] 审核结果通知
- [ ] 消息中心页面
- [ ] 消息已读/未读状态

#### 8. 性能优化
- [ ] Redis缓存优化
- [ ] 数据库查询优化
- [ ] 接口响应时间优化
- [ ] 前端资源加载优化
- [ ] CDN集成

#### 9. 安全加固
- [ ] 接口限流（防止刷接口）
- [ ] 防爬虫机制
- [ ] 敏感词过滤
- [ ] 内容安全审核（AI审核）
- [ ] 数据加密传输

### 低优先级功能

#### 10. 多端同步
- [ ] 阅读进度多端同步
- [ ] 设置多端同步
- [ ] 书架多端同步

#### 11. 其他功能优化
- [ ] 小说分类管理优化
- [ ] 标签系统
- [ ] 作者专区
- [ ] 打赏功能
- [ ] 分享功能优化
