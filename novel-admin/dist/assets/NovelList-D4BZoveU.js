import{_ as H,r as m,k as Q,s as W,c as X,o as E,b as v,d as t,w as l,g as d,v as Y,e as n,E as _,f as Z,x as ee,j as r,i as te,y as ae,z as le,A as oe,n as V,t as R,p as ne,B as se,C as re,D as ie,F as ue,q as de}from"./index-CYHA9V5Y.js";import{n as x}from"./index-BCOtO_Mw.js";const pe={class:"novel-list"},ce={class:"header"},me={__name:"NovelList",setup(ve){const g=Z(),f=m(!1),C=m([]),p=m(1),b=m(10),k=m(0),s=m({keyword:"",status:""}),T=Q(()=>f.value?"加载中...":"暂无数据"),S=a=>({DRAFT:"",PENDING:"warning",APPROVED:"success",REJECTED:"danger"})[a]||"",z=a=>({DRAFT:"草稿",PENDING:"待审核",APPROVED:"已审核",REJECTED:"已拒绝"})[a]||a,i=async()=>{f.value=!0;try{const a={pageNum:p.value,pageSize:b.value,keyword:s.value.keyword||void 0,status:s.value.status||void 0},e=await x.getList(a);C.value=e.data.records||[],k.value=e.data.total||0}catch(a){_.error(a.message||"加载失败"),C.value=[],k.value=0}finally{f.value=!1}},w=()=>{p.value=1,i()},A=()=>{s.value={keyword:"",status:""},p.value=1,i()},P=()=>{p.value=1,i()},F=a=>a?a>=1e4?(a/1e4).toFixed(1)+"万":a.toString():"0",B=()=>{g.push("/novel/edit")},$=a=>{g.push(`/novel/edit/${a.id}`)},I=a=>{g.push(`/novel/${a.id}/chapters`)},U=async a=>{try{await x.submitAudit(a.id),_.success("提交成功"),i()}catch(e){_.error(e.message||"提交失败")}},j=async a=>{await de.confirm("确定要删除吗？","提示",{type:"warning"});try{await x.delete(a.id),_.success("删除成功"),i()}catch(e){_.error(e.message||"删除失败")}};return W(()=>{i()}),(a,e)=>{const u=n("el-button"),G=n("el-input"),h=n("el-form-item"),y=n("el-option"),J=n("el-select"),L=n("el-form"),N=n("el-card"),c=n("el-table-column"),M=n("el-tag"),O=n("el-table"),K=n("el-pagination"),q=ee("loading");return E(),X("div",pe,[v("div",ce,[e[5]||(e[5]=v("div",{class:"header-left"},[v("h2",null,"小说管理"),v("p",{class:"subtitle"},"管理所有小说内容")],-1)),t(u,{type:"primary",icon:d(Y),onClick:B},{default:l(()=>[...e[4]||(e[4]=[r("新增小说",-1)])]),_:1},8,["icon"])]),t(N,{class:"search-card"},{default:l(()=>[t(L,{inline:!0,model:s.value},{default:l(()=>[t(h,{label:"关键词"},{default:l(()=>[t(G,{modelValue:s.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.keyword=o),placeholder:"请输入标题或作者",clearable:"",onClear:w,onKeyup:te(w,["enter"]),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(h,{label:"状态"},{default:l(()=>[t(J,{modelValue:s.value.status,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.status=o),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:l(()=>[t(y,{label:"草稿",value:"DRAFT"}),t(y,{label:"待审核",value:"PENDING"}),t(y,{label:"已审核",value:"APPROVED"}),t(y,{label:"已拒绝",value:"REJECTED"})]),_:1},8,["modelValue"])]),_:1}),t(h,null,{default:l(()=>[t(u,{type:"primary",icon:d(ae),onClick:w},{default:l(()=>[...e[6]||(e[6]=[r("搜索",-1)])]),_:1},8,["icon"]),t(u,{icon:d(le),onClick:A},{default:l(()=>[...e[7]||(e[7]=[r("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),t(N,null,{default:l(()=>[oe((E(),V(O,{data:C.value,style:{width:"100%"},stripe:"","empty-text":T.value},{default:l(()=>[t(c,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),t(c,{prop:"category",label:"分类",width:"120"}),t(c,{prop:"status",label:"状态",width:"120"},{default:l(({row:o})=>[t(M,{type:S(o.status)},{default:l(()=>[r(R(z(o.status)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"viewCount",label:"阅读量",width:"100",align:"right"},{default:l(({row:o})=>[v("span",null,R(F(o.viewCount)),1)]),_:1}),t(c,{prop:"createTime",label:"创建时间",width:"180"}),t(c,{label:"操作",width:"240",fixed:"right"},{default:l(({row:o})=>[t(u,{link:"",type:"primary",icon:d(se),onClick:D=>$(o)},{default:l(()=>[...e[8]||(e[8]=[r("编辑",-1)])]),_:1},8,["icon","onClick"]),t(u,{link:"",type:"primary",icon:d(re),onClick:D=>I(o)},{default:l(()=>[...e[9]||(e[9]=[r("章节",-1)])]),_:1},8,["icon","onClick"]),o.status==="DRAFT"?(E(),V(u,{key:0,link:"",type:"success",icon:d(ie),onClick:D=>U(o)},{default:l(()=>[...e[10]||(e[10]=[r(" 提交审核 ",-1)])]),_:1},8,["icon","onClick"])):ne("",!0),t(u,{link:"",type:"danger",icon:d(ue),onClick:D=>j(o)},{default:l(()=>[...e[11]||(e[11]=[r("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data","empty-text"])),[[q,f.value]]),t(K,{"current-page":p.value,"onUpdate:currentPage":e[2]||(e[2]=o=>p.value=o),"page-size":b.value,"onUpdate:pageSize":e[3]||(e[3]=o=>b.value=o),total:k.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:i,onSizeChange:P,style:{"margin-top":"20px","justify-content":"flex-end",display:"flex"}},null,8,["current-page","page-size","total"])]),_:1})])}}},ye=H(me,[["__scopeId","data-v-c1f366e3"]]);export{ye as default};
